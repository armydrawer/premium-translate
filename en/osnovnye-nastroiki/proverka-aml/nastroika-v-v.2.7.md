# Настройка в v.2.7

## Настройка модуля AML

Убедитесь, что модуль активирован в разделе "**Модули**" или активируйте его.

<figure><img src="../../.gitbook/assets/image (2106).png" alt="" width="563"><figcaption></figcaption></figure>

Добавьте один из 4-х поддерживаемых сервисов в разделе "**AML**" -> "**Добавить**".

{% hint style="warning" %}
Не забывайте пополнять баланс на стороне выбранного сервиса, чтобы иметь возможность проверять адреса и транзакции!
{% endhint %}

<figure><img src="../../.gitbook/assets/image (2105).png" alt="" width="484"><figcaption></figcaption></figure>

В новом окне заполните авторизационные данные в блоке "**Настройки модуля**":

{% tabs %}
{% tab title="AML Bot" %}
<figure><img src="../../.gitbook/assets/image (247).png" alt="" width="462"><figcaption></figcaption></figure>

### Подключение к сервису <a href="#podklyuchenie-k-servisu" id="podklyuchenie-k-servisu"></a>

Пройдите регистрацию на сервисе [AMLBot](https://web.amlbot.com/signup?), авторизуйтесь в личном кабинете и выпустите ID и ключ для авторизации в модуле.

<figure><img src="../../.gitbook/assets/image (251).png" alt=""><figcaption></figcaption></figure>

Укажите данные ключи в соответствующих полях в настройках модуля и сохраните данные.
{% endtab %}

{% tab title="BitOk" %}
<figure><img src="../../.gitbook/assets/image (248).png" alt="" width="461"><figcaption></figcaption></figure>

### Подключение к сервису <a href="#podklyuchenie-k-servisu" id="podklyuchenie-k-servisu"></a>

Для подключения к сервису напишите [менеджеру](https://t.me/premiumexchanger_business) — он создаст чат с вами и представителями AML сервиса для обсуждения условий подключения, тарифов и других вопросов

После получения доступа к сервису пополните счет для выполнения проверок реквизитов клиентов на вашем обменнике.

Зайдите в личный кабинет, раздел "[**Ключи API**](https://kyt.bitok.org/api-keys)". Выпустите новый ключ по кнопке "**Создать ключ**", в открывшемся окне укажите желаемое название для ключа и IP-адрес вашего сервера (необязательно).

<figure><img src="https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FgIzth95zoCr0EOsUo9oj%252Fimage.png%3Falt%3Dmedia%26token%3D32a05d2f-48ec-47cf-aa8d-70cc487756e1&#x26;width=768&#x26;dpr=4&#x26;quality=100&#x26;sign=87b578bc&#x26;sv=2" alt="" width="563"><figcaption></figcaption></figure>

Нажмите "**Создать**" и скопируйте в текстовый файл сгенерированные ключи.

<figure><img src="https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FYOk96z3uNPDpR60IPc69%252Fimage.png%3Falt%3Dmedia%26token%3D3ab0171e-90d8-4ca9-ae24-abf3eeaa3421&#x26;width=768&#x26;dpr=4&#x26;quality=100&#x26;sign=348e2df1&#x26;sv=2" alt="" width="563"><figcaption></figcaption></figure>

Укажите данные ключи в соответствующих полях в настройках модуля и сохраните данные.
{% endtab %}

{% tab title="CoinKyt" %}
<figure><img src="../../.gitbook/assets/image (249).png" alt="" width="461"><figcaption></figcaption></figure>

### Подключение к сервису <a href="#podklyuchenie-k-servisu" id="podklyuchenie-k-servisu"></a>

Для подключения к сервису напишите [менеджеру](https://t.me/premiumexchanger_business) — он создаст чат с вами и представителями AML сервиса для обсуждения условий подключения, тарифов и других вопросов

Зайдите в личный кабинет и выпустите новый ключ по кнопке "**Сгенерировать**" в разделе "**API**". Скопируйте выпущенный ключ в буфер обмена или в текстовый файл.

<figure><img src="https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FHkttfrUnvNLrOw6Chvhx%252Fimage.png%3Falt%3Dmedia%26token%3D6a543cea-2f74-4014-b383-8c12eebd0132&#x26;width=768&#x26;dpr=4&#x26;quality=100&#x26;sign=4c5ecb43&#x26;sv=2" alt="" width="563"><figcaption></figcaption></figure>

Укажите данный ключ в соответствующем поле в настройках модуля и сохраните данные.
{% endtab %}

{% tab title="GetBlock" %}
<figure><img src="../../.gitbook/assets/image (250).png" alt="" width="457"><figcaption></figcaption></figure>

### Подключение к сервису <a href="#podklyuchenie-k-servisu" id="podklyuchenie-k-servisu"></a>

Для получения API-ключа напишите письмо на [info@getblock.net](mailto:info@getblock.net). Укажите полученный от представителя сервиса ключ в соответствующем поле в настройках модуля и сохраните данные.
{% endtab %}
{% endtabs %}

## Общие настройки

<figure><img src="../../.gitbook/assets/image (237).png" alt="" width="329"><figcaption></figcaption></figure>

**Риск, если API не работает** — желаемое значение риска (от 0 до 100), которое будет иметь результат проверки, если от API сервиса не будет получен ответ. Значение <mark style="color:red;">**должно быть**</mark> выше значения из полей "**Критичный уровень риска адреса/хеша**".

<div><figure><img src="../../.gitbook/assets/image (238).png" alt="" width="325"><figcaption></figcaption></figure> <figure><img src="../../.gitbook/assets/image (239).png" alt="" width="326"><figcaption></figcaption></figure></div>

**Критичный уровень риска адреса/хеша** — <mark style="color:red;">**обязательно**</mark> укажите значение (от 0 до 100), при превышении которого модуль будет сообщать о риске для заявки в разделе "**Заявки**" (перед настройкой раздела рекомендуем запросить у менеджера выбранного AML-сервиса консультацию по настройке уровня риска)

<figure><img src="../../.gitbook/assets/image (242).png" alt="" width="322"><figcaption></figcaption></figure>

**Время ожидания результата проверки (сек, макс до 25-30 сек)** — время ожидания ответа от сервиса после отправки данных для проверки (рекомендуем устанавливать значение в диапазоне от 15 до 28).

**Тайм-аут (сек.) работы скрипта** — время в течение которого сайт ожидает ответа от AML-сервиса. Если ответ не будет получен в заданное время, то сайт продолжит свою работу далее, оставшись без ответа. Если время не задано или равно 0, то действует стандартный таймаут в 20 секунд. Универсального значения для таймаута нет, потому что он зависит от скорости работы конкретного сервиса.

<figure><img src="../../.gitbook/assets/image (241).png" alt="" width="281"><figcaption></figcaption></figure>

**Отключить логи** — отключение логов о проверках (не рекомендуется)

**Категории проверок** — установка уровней риска для тех или иных категорий. Запросите консультацию у сервиса, который вы подключаете, с просьбой помочь с тонкой настройкой категорий (обратите внимание, что для каждого модуля свой набор категорий для настройки)

<figure><img src="../../.gitbook/assets/image (246).png" alt="" width="322"><figcaption></figcaption></figure>

## Ручные проверки

В модуле AML есть возможность проводить ручные проверки адресов, хэшей и транзакций. Для проведения проверки перейдите в настройки настроенного сервиса, укажите данные для проверки и нажмите кнопку "**Проверка**".

{% hint style="info" %}
TxID — это уникальный идентификатор транзакции, который генерируется **до того**, как транзакция попадает в блокчейн. Обычно это хэш от данных транзакции (например, входы, выходы, подписи), но до того, как транзакция будет включена в блок.

* **Для чего используется?**\
  TxID позволяет быстро находить транзакцию в блокчейне. Это как "номер заказа" в системе.
* **Пример:**\
  Если вы отправляете криптовалюту, TxID — это то, что вы видите сразу после создания транзакции. Это помогает отслеживать статус транзакции до её подтверждения.

Хэш транзакции — это уникальный идентификатор, который формируется **после того**, как транзакция включается в блок. Он вычисляется на основе данных транзакции и дополнительной информации (например, номера блока, времени и других параметров).

* **Для чего используется?**\
  Хэш транзакции используется для проверки целостности данных в блокчейне. Он гарантирует, что транзакция не была изменена после её включения в блок.
* **Пример:**\
  Хэш транзакции можно сравнить с "отпечатком пальца" транзакции после её подтверждения. Он уникален и зависит от всех данных, связанных с транзакцией в блоке.

#### **Аналогия**

Представьте, что вы отправляете письмо:

* **TxID** — это номер почтового отправления, который вы получаете сразу после того, как отдали письмо на почту. Он помогает отслеживать письмо до его доставки.
* **Хэш транзакции** — это уникальная печать на конверте, которая ставится после того, как письмо доставлено и зарегистрировано. Она подтверждает, что письмо действительно было доставлено и не было изменено.

Таким образом, TxID и хэш транзакции — это два этапа идентификации транзакции: до и после её включения в блокчейн.
{% endhint %}

{% tabs %}
{% tab title="AML Bot" %}
<figure><img src="../../.gitbook/assets/image (232).png" alt="" width="466"><figcaption></figcaption></figure>

**Проверка адреса** — проверка адреса кошелька. Укажите адрес и выберите нужную валюту

**Проверка транзакции** — проверка транзакции. Укажите адрес кошелька <mark style="color:green;">**получателя**</mark>**,** выберите нужную валюту, укажите TxID и выберите тип сделки (deposit (пополнение) или withdrawal (вывод средств)

**Проверка uid** — проверка уникального идентификатора из ответа на запрос проверки транзакции

<figure><img src="../../.gitbook/assets/image (158).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="BitOk" %}
<figure><img src="../../.gitbook/assets/image (233).png" alt="" width="472"><figcaption></figcaption></figure>

**Проверка адреса** — проверка адреса кошелька. Укажите адрес и выберите нужную валюту

**Проверка транзакции** — проверка транзакции. Укажите адрес кошелька <mark style="color:green;">**получателя**</mark>**,** выберите нужную валюту и укажите TxID
{% endtab %}

{% tab title="CoinKyt" %}
<figure><img src="../../.gitbook/assets/image (234).png" alt="" width="473"><figcaption></figcaption></figure>

**Проверка адреса** — проверка адреса кошелька. Укажите адрес и выберите нужную валюту

**Проверка транзакции** — проверка транзакции. Укажите TxID и выберите нужную валюту
{% endtab %}

{% tab title="GetBlock" %}
<figure><img src="../../.gitbook/assets/image (235).png" alt="" width="452"><figcaption></figcaption></figure>

**Проверка адреса** — проверка адреса кошелька. Укажите адрес и выберите нужную валюту

**Проверка транзакции** — проверка транзакции. Укажите адрес кошелька получателя, выберите нужную валюту, укажите TxID и выберите тип сделки (deposit (пополнение) или withdrawal (вывод средств)

Проверка хэша — проверка хэша из ответа на запрос проверки транзакции

<figure><img src="../../.gitbook/assets/image (159).png" alt=""><figcaption></figcaption></figure>
{% endtab %}
{% endtabs %}

Результат проверки будет отображаться в начале страницы:

<figure><img src="../../.gitbook/assets/image (236).png" alt=""><figcaption></figcaption></figure>

## Логирование

В разделе "**AML**" -> "**Логи**" будут отображаться результаты проверок, а также ошибки при работе с сервисами.

<figure><img src="../../.gitbook/assets/image (2107).png" alt=""><figcaption></figcaption></figure>

## Настройка модуля в направлении обмена

Вы можете использовать модуль как для проверки адреса и хеша без вмешательств в заявку, так и для запрета создания заявки или запрета выплаты по ней.

Откройте настройки направления обмена, в котором хотите использовать проверки и перейдите на вкладку "**AML**". Выберите настроенный ранее AML-сервис и настройте указанные опции.

<figure><img src="../../.gitbook/assets/image (243).png" alt=""><figcaption></figcaption></figure>

Проверка счетов "**Отдаю**" и "**Получаю**":

![](https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252F7R3KdtN6GGnYeNXhmRma%252Fimage.png%3Falt%3Dmedia%26token%3D63493485-ecb6-47e6-9f1b-2401b3502abe\&width=768\&dpr=4\&quality=100\&sign=ab6174df\&sv=2)![](https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FD3WNc4TbMfIAV3uhgBab%252Fimage.png%3Falt%3Dmedia%26token%3D5547117b-2df9-437b-8601-e31e26f6930e\&width=768\&dpr=4\&quality=100\&sign=2384dec3\&sv=2)

* **Нет** — проверка не будет производиться
*   **Да, во время создания заявки** — проверка будут производиться для запрета создания заявки при превышении заданного уровня риска



    <figure><img src="https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FrCkAUosTHwbhajPIQwjp%252Fbrave_nG8qmZEGwR.png%3Falt%3Dmedia%26token%3Dd2063fa4-97fa-4736-97d5-bd3fd8220467&#x26;width=768&#x26;dpr=4&#x26;quality=100&#x26;sign=93fefc8d&#x26;sv=2" alt="" width="563"><figcaption></figcaption></figure>
* **Да, при оплате** — проверка счета будет производиться при приеме платежа, сделанного клиентом (но только если в направлении обмена подключен модуль мерчанта на прием средств)

<figure><img src="../../.gitbook/assets/image (244).png" alt=""><figcaption></figcaption></figure>

* **Да, во время автовыплаты** — проверка счета будет производиться перед выплатой средств клиенту (но только если в направлении обмена подключен модуль автовыплаты средств)
* **Превышение риска:**\
  • **Ничего** — проверки будут производиться только для информационных целей \
  • **Ошибка** — при превышении риска, указанного в настройках модуля, клиенту будет отображаться ошибка при создании заявки или при попытке автовыплаты (в зависимости от настроек)
* **Сумма обмена "от"** — размер суммы из заявки, только при превышении которого будет выполняться проверка адреса или транзакции. При сумме в заявке ниже указанной, проверка выполняться не будет.

{% hint style="warning" %}
Значение указывается в валюте, для которой будет проверяться адрес (к примеру для проверки адреса USDT укажите 1000, для BTC — 0.015 и т.п. — минимальный размер сумм из заявок, для которых будут выполняться проверки, вы указываете на своё усмотрение)
{% endhint %}

Проверка TxID:

![](https://premium.gitbook.io/~gitbook/image?url=https%3A%2F%2F2574066779-files.gitbook.io%2F%7E%2Ffiles%2Fv0%2Fb%2Fgitbook-x-prod.appspot.com%2Fo%2Fspaces%252Fm9kqZXsNykrN6VyxxXBO%252Fuploads%252FGKXGBpd9faaSHOJsRBJG%252Fimage.png%3Falt%3Dmedia%26token%3D3016e6fb-ec81-4428-89c1-4b840b798573\&width=768\&dpr=4\&quality=100\&sign=7c6d03ba\&sv=2)

* **Нет** — проверка TxID входящего платежа не будет производиться
* **Да, при оплате** — проверка TxID входящего платежа будет производиться при приеме платежа, сделанного клиентом (но только если в направлении обмена подключен модуль мерчанта на прием средств)
* **Да, во время автовыплаты** — проверка TxID входящего платежа будет производиться перед выплатой средств клиенту (но только если в направлении обмена подключен модуль автовыплаты средств)

<figure><img src="../../.gitbook/assets/image (245).png" alt="" width="563"><figcaption></figcaption></figure>

* **Сумма обмена "от"** — укажите размер суммы из заявки, при превышении которого будет выполняться проверка хеша. При сумме ниже указанной, проверка выполняться не будет (значение суммы указывается в валюте для стороны "**Отдаю**")
