# Обновление с версии 2.6 до 2.7

{% hint style="success" %}
Список обновлений скрипта для версии 2.7 доступен по [**ссылке**](https://premium.gitbook.io/main/pered-nachalom-raboty/instrukciya-po-obnovleniyu-skripta/spisok-obnovlenii#versiya-2.7)
{% endhint %}

{% hint style="warning" %}
Перед началом обновление скрипта, выполните обновление на сервере Ioncube Loader до версии 14.0 и выше (если установленная версия ниже 14 — [**инструкция по проверке установленной версии**](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-proverit-versiyu-ioncube-ustanovlennuyu-na-servere)**,** [**инструкция по обновлению**](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-obnovit-ioncube-loader)). В обновлении поможет техническая поддержка вашего хостинга.
{% endhint %}

{% hint style="warning" %}
Если вы используете модули мерчантов и автовыплат, разработанными нами персонально для вас **—** запросите обновленные модули в вашей группе в Телеграм (**не в технической поддержке через бота**).

Если вы используете модули мерчантов и автовыплат, а также другие типы модулей от сторонних разработчиков, то они не будут работать на версии 2.7 без их обновления со стороны разработчиков.
{% endhint %}

{% hint style="warning" %}
Если вы использовали модули Electrum и/или "Торговые действия" в версии 2.6 **—** запросите модули под версию 2.7 в вашей группе в Телеграм (**не в технической поддержке через бота**).
{% endhint %}

{% hint style="warning" %}
**Обратите внимание — при обновления скрипта с версии 2.6 на 2.7 требуется обновление (бесплатное) тем с персональным дизайном нашей разработки для сайта!**

Если вы используете такой дизайн — пришлите архив с темой для адаптации под версию 2.7.\
Для этого перейдите на сервере в папку по пути `www/<имя_сайта>/wp-content/themes/`, найдите папку с вашей темой, заархивируйте её, скачайте на компьютер, а затем пришлите архив в вашу группу в Телеграм.
{% endhint %}

{% hint style="danger" %}
<mark style="color:red;">**Перед обновлением обязательно сделайте резервную копию сайта и базы данных!**</mark>

В случае, если во время обновления что-то пойдет не так, вы всегда сможете восстановить сайт из резервной копии. Способы резервного копирования могут отличаться в зависимости от хостинга, поэтому вам стоит обратиться в техническую поддержку вашего хостинга с данным вопросом.

Самый простой способ [**сделать резервную копию сайта**](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-sdelat-bekap-saita) — через панель управления сервером (ISP Manager или другое ПО) с помощью встроенного в панель файлового менеджера или через FTP-клиент (скачайте на компьютер файлы сайта, а также в разделе управления базами данных или через PhpMyAdmin скачайте БД сайта).
{% endhint %}



## Процесс обновления

1.  В панели управления обменником в разделе "**Консоль**" включите технический режим работы обменника, чтобы пользователи обменника не совершали заявки на сайте во время обновления скрипта.

    <figure><img src="../../.gitbook/assets/image (938).png" alt=""><figcaption></figcaption></figure>
2.  В разделе "**Плагины**" деактивируйте плагины "**Premium Exchanger**" и "**Premium Exchanger hooks**".\


    <figure><img src="../../.gitbook/assets/image (313).png" alt=""><figcaption></figcaption></figure>
3. С помощью FTP-клиента или файлового менеджера удалите на сервере содержимое папки **`/wp-content/plugins/premiumbox/`**, <mark style="color:green;">**кроме**</mark> следующих файлов и папок внутри неё:

* **`/flags/`**
* **`/languages/`**
* **`/moduls/`** (но сперва ознакомьтесь с текстом в блоке ниже)

{% hint style="info" %}
- Если вы **используете** модуль Webmoney — не удаляйте папку **`x19`** внутри папки **`moduls`**
- Если вы **не используете** модуль Webmoney — можете удалить папку **`moduls`** целиком
{% endhint %}

* **`/sms/`**
* **`/userdata.php`**

<figure><img src="../../.gitbook/assets/image (1834).png" alt="" width="563"><figcaption><p><strong>Удалите все отмеченные галочкой файлы и папки на своём сервере</strong></p></figcaption></figure>

4.  Удалите все файлы предыдущей лицензии из корневой папки сайта.\


    <figure><img src="../../.gitbook/assets/image (1833).png" alt="" width="432"><figcaption></figcaption></figure>

Перейдите в раздел "[**Ваши лицензии**](https://premiumexchanger.com/ulicense/)" и скачайте архив с файлами лицензии `license.zip`. Для этого нажмите на ссылку "**Скачать для версии 2.7**".\


<figure><img src="../../.gitbook/assets/image (314).png" alt="" width="430"><figcaption></figcaption></figure>

Скачанный архив загрузите в [корневую папку вашего сайта](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-naiti-kornevuyu-papku-saita-na-servere) под <mark style="color:green;">**пользователем, созданным для сайта**</mark> (не <mark style="color:red;">**root**</mark>!) и **обязательно** распакуйте архив.

{% hint style="danger" %}
**Выполните шаг 4 в обязательном порядке, даже если файлы лицензии были ранее загружены на сервер — в противном случае сайт не будет работать!**
{% endhint %}

5. Перейдите в раздел "[**Ваши скрипты**](https://premiumexchanger.com/uscripts/)" и на странице скачайте архив с **файлами для обновления версии 2.7** под вашу версию PHP.

{% hint style="danger" %}
Необходимо точно знать версию PHP, установленную на вашем сервере, для выбора подходящего архива.\
[**Инструкция по проверке версии PHP, установленной на сервере**](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-proverit-versiyu-php-ustanovlennuyu-na-servere)
{% endhint %}

<figure><img src="../../.gitbook/assets/image (316).png" alt="" width="563"><figcaption></figcaption></figure>

6. Загрузите содержимое архива с обновлением в корневую папку вашего сайта под <mark style="color:green;">**пользователем, созданным для сайта**</mark> (не <mark style="color:red;">**root**</mark>!). Используйте FTP-клиент, либо файловый менеджер. Распакуйте архив с заменой файлов.
7. Перейдите в раздел "**Плагины**" и активируйте плагины "**Premium Exchanger"** и "**Premium Exchanger hooks**".
8. Перейдите в раздел **Настройки обменника" → "Миграция"** и в блоке "**Миграция (если версия меньше 2.7)**" поочередно выполните каждый шаг.

{% hint style="danger" %}
Если вы использовали модули AML в версии 2.6 — необходимо включить модуль AML в разделе "**Модули**" <mark style="color:red;">**после**</mark> обновления скрипта и <mark style="color:red;">**перед**</mark> выполнением миграции для корректного переноса настроек с версии 2.6.

![](<../../.gitbook/assets/image (2068).png>)

Аналогичная ситуация при использовании коэффициентов (раздел "**Парсеры 2.0**" ➔ "**Пользовательские коэффициенты**") — если вы использовали коэффициенты в версии 2.6, необходимо включить одноименный модуль в разделе "**Модули**" <mark style="color:red;">**после**</mark> обновления скрипта и <mark style="color:red;">**перед**</mark> выполнением миграции для корректного переноса коэффициентов с версии 2.6.

![](<../../.gitbook/assets/image (2074).png>)
{% endhint %}

<figure><img src="../../.gitbook/assets/image (2273).png" alt="" width="362"><figcaption></figcaption></figure>

При запуске каждого шага система определит общее количество запросов, которые нужно выполнить. У вас есть возможность задать количество запросов, которое будет обработано за один цикл.

<figure><img src="../../.gitbook/assets/image (559).png" alt="" width="345"><figcaption></figcaption></figure>

{% hint style="warning" %}
По умолчанию количество запросов = 50. Если вы не уверены в мощности вашего сервера, то рекомендуем не менять значение по умолчанию.

При необходимости вы можете указать любое другое значение, но если выполнение цикла с указанным значением окажется слишком ресурсоемким для сервера — это вызовет ошибку.
{% endhint %}

{% hint style="info" %}
Вы можете увидеть кнопки "**Технический шаг X**" рядом с кнопками "**Шаг X**". Перед выполнением каждого шага, система определяется количество запросов, которые необходимо выполнить. В некоторых случаях количество запросов может быть слишком велико и сервер может не справиться с их подсчетом. В этом случае вместо кнопки "**Шаг X**" стоит использовать кнопку "**Технический шаг X**", которая позволяет задавать произвольное количество запросов вручную без подсчета количества запросов сервером.

Если вы используете **технический шаг**, то вам необходимо задать вручную количество запросов. Рекомендуем установить заведомо большое число, например, 100000.
{% endhint %}

9.  Перейдите в раздел "**Настройки" → "Постоянные ссылки"** и нажмите на кнопку "**Сохранить изменения**", не внося никаких изменений на странице.\


    <figure><img src="../../.gitbook/assets/image (318).png" alt="" width="563"><figcaption></figcaption></figure>
10. Перейдите в раздел "**Заявки"** и отключите режим обновления.\


    <figure><img src="../../.gitbook/assets/image (319).png" alt=""><figcaption></figcaption></figure>

{% hint style="warning" %}
Режим обновления активируется каждый раз после деактивации и повторной активации основного плагина, поэтому режим всегда необходимо отключать вручную.
{% endhint %}

11. Если вы используете модули "**Парсеры 2.0**" или "**Bestchange парсер**" — после отключения режима обновления необходимо запустить работу парсеров в соответствующих разделах, вручную переходом по ссылке Сron.\
    Для работы Парсеров 2.0:

    <figure><img src="../../.gitbook/assets/image (453).png" alt=""><figcaption></figcaption></figure>

    Для работы BestChange парсера:

    <figure><img src="../../.gitbook/assets/image (451).png" alt="" width="563"><figcaption></figcaption></figure>
12. [Очистите кэш в браузере](https://www.unisender.com/ru/blog/kak-ochistit-kehsh-v-brauzerah/).\


    <figure><img src="../../.gitbook/assets/image (454).png" alt="" width="563"><figcaption></figcaption></figure>
13. <mark style="color:red;">**Обязательно удалите из корневой папки на сервере все загруженные zip-архивы скрипта и бэкапы сайта.**</mark>\


    <figure><img src="../../.gitbook/assets/image (455).png" alt="" width="563"><figcaption></figcaption></figure>
14. Отключите режим технического обслуживания в разделе "**Консоль**".
15. <mark style="color:green;">**Обновление успешно проведено!**</mark>
