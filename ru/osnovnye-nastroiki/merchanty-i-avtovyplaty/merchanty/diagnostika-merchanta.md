# Диагностика мерчанта

Настройки  модулей

Если ошибка возникает сразу после нажатия кнопки "**Перейти к оплате**", то необходимо выполнить следующие действия:

* Убедитесь, что задано примечание платежа в настройках мерчанта в разделе "**Мерчанты → "Мерчанты"**. Для некоторых платежных систем, к примеру для Яндекс.Деньги и Приват24, примечание платежа является обязательным параметром. Обычно примечание платежа выглядит так: **`Заявка [exchange_id]`.**

<figure><img src="../../../.gitbook/assets/image (902).png" alt=""><figcaption></figcaption></figure>

* B настройках мерчанта в разделе "**Мерчанты" → "Мерчанты"** включите опцию "**Режим отладки**" и попробуйте перейти к оплате снова. Полученный текст ошибки в разделе "**Мерчанты**" -> "**Лог мерчантов**" будет говорить о существующей проблеме.

<figure><img src="../../../.gitbook/assets/image (1232).png" alt=""><figcaption></figcaption></figure>

В панели управления сайтом в разделе "**Модули" → "Модули"** — активируйте модуль "**!Не активируйте без необходимости! Лог мерчантов**".

{% hint style="warning" %}
После проведения тестирования обязательно отключите модуль
{% endhint %}

Создайте тестовую заявку и оплатите её. Затем в разделе "**Мерчанты" → "Лог мерчантов"** найдите лог тестовой заявки от платежной системы, через которую вы оплатили заявку.

<figure><img src="../../../.gitbook/assets/image (1106).png" alt=""><figcaption></figcaption></figure>

Если после оплаты **лог зафиксировался**, но статус заявки не изменился, необходимо выполнить следующие действия:

* Заново задать настройки мерчанта в разделе "**Мерчанты" → "Мерчанты"**
* Проверить, что сумма, которая поступила на кошелек, равна сумме указанной в тестовой заявке или больше требуемой
* Для мерчантов Yandex money, Privat24 (и других мерчантов, которые берут комиссию с обменника за входящий платеж) необходимо включить пункт "**Нестандартная комиссия мерчанта**" в настройках самого мерчанта в разделе "**Мерчанты" → "Мерчанты"**, а также в настройках конкретного направления обмена во вкладке "**Комиссии платежных систем**" для валюты "Отдаю" установить галочку "**нестандартная комиссия**" и указать % комиссии платежной системы

<figure><img src="../../../.gitbook/assets/image (978).png" alt="" width="563"><figcaption></figcaption></figure>

* Для некоторых мерчантов требуется настроить [планировщик задач (Cron)](https://premium.gitbook.io/rukovodstvo-polzovatelya/osnovnye-nastroiki/faq/kak-sozdat-zadanie-cron-na-servere), который проверяет статус заявки после оплаты пользователя. Попробуйте открыть ссылку Cron в браузере. Если при переходе по ссылке статус заявки поменяется, то значит либо не настроен планировщик задач, либо настроен некорректно и автоматически не срабатывает. Обратитесь в техническую поддержку провайдера хостинга за помощью в настройке планировщика задач.
*   Если в логе появилась ошибка о том, что IP-адрес сервера не находится в белом списке - обратить в техподдержку мерчанта с просьбой добавить этот IP-адрес, после этого проведите заявку повторно.

    <figure><img src="../../../.gitbook/assets/image (1268).png" alt="" width="563"><figcaption></figcaption></figure>

Если после оплаты **лог не зафиксировался**, необходимо проверить следующие настройки:

* Если используется опция "**Разрешенные IP адреса**" для статусного файла мерчанта, то убедитесь, что в настройках мерчанта в разделе "**Мерчанты" → "Мерчанты"** заданы актуальные IP-адреса. Удалите IP-адреса при тестировании.

<figure><img src="../../../.gitbook/assets/image (958).png" alt=""><figcaption></figcaption></figure>

* В настройках платежной системы должен быть указан актуальный STATUS/RESULT URL, который находится в настройках мерчанта в разделе "**Мерчанты" → "Мерчанты"** внизу страницы с настройками мерчанта.

<figure><img src="../../../.gitbook/assets/image (1014).png" alt=""><figcaption></figcaption></figure>

Если опция "**Хэш для Status/Result URL**" ранее не использовалась, а позже вы добавили хэш в указанном поле, то убедитесь, что в настройках платежной системы указан актуальный адрес с учетом заданного хэша. Убедитесь, что на стороне платежной системы STATUS/RESULT URL указан через **http** или **https** в зависимости от типа соединения на вашем сайте.

<figure><img src="../../../.gitbook/assets/image (894).png" alt=""><figcaption></figcaption></figure>

* Убедитесь, что Firewall на сервере или, если сайт подключен к сервису CDN типа Cloudflare, не блокирует обращения платежной системы к статусному файлу STATUS/RESULT URL мерчанта.
