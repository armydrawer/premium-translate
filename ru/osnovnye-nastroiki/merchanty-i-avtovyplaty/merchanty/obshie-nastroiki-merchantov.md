# Общие настройки мерчантов

Большинство настроек, указанных в разделе, используются во всех разработанных модулях для мерчантов. Некоторые мерчанты имеют особенные параметры, которые будут рассмотрены непосредственно в инструкциях по настройке этих мерчантов.

## Настройки модуля

В связи с тем, что каждый мерчант имеет свой API для авторизации, поля для раздела могут отличаться между собой — вводите полученные от мерчанта авторизационные данные согласно названию полей.

{% tabs %}
{% tab title="Вариант 1" %}
<figure><img src="../../../.gitbook/assets/изображение (125).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Вариант 2" %}
<figure><img src="../../../.gitbook/assets/изображение (8).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Вариант 3" %}
<figure><img src="../../../.gitbook/assets/изображение (10).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Вариант 4" %}
<figure><img src="../../../.gitbook/assets/изображение (20).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Вариант 5" %}
<figure><img src="../../../.gitbook/assets/изображение (138).png" alt=""><figcaption></figcaption></figure>
{% endtab %}

{% tab title="Вариант 6" %}
<figure><img src="../../../.gitbook/assets/изображение (120).png" alt=""><figcaption></figcaption></figure>
{% endtab %}
{% endtabs %}

## Настройки

{% hint style="warning" %}
Обратите внимание, что при использовании некоторых модулей мерчантов необходимо создать [отдельную копию модуля мерчанта](#user-content-fn-1)[^1] <mark style="color:red;">**для каждой фиатной валюты/криптовалюты/сети криптовалюты**</mark>. В каждой копии необходимо выбрать/указать соответствующий пункт (это поле для заполнение или выпадающий список "**Сеть**"/"**Способ оплаты**"/"**Тип транзакции**"), а затем подключить копию этого модуля на вкладке "**Мерчанты и выплаты**" в настройках направления обмена, где в валюте "**Отдаю**" используется указанная валюта.
{% endhint %}

{% hint style="danger" %}
Если в настройках модуля мерчанта отображается поле "**Примечание для платежа**" — обязательно заполните его текстом **`ID заявки: [exchange_id]`** или просто **`[exchange_id]`**.

Это необходимо для привязки заявки к транзакции по ней у самого мерчанта — без указания этого шорткода не будет меняться статус заявки.

![](<../../../.gitbook/assets/image (1508).png>)
{% endhint %}

В блоке ниже указываются общие настройки для работы мерчанта.

<figure><img src="../../../.gitbook/assets/image (2204).png" alt="" width="531"><figcaption></figcaption></figure>

* **Инструкция по оплате для пользователя —** укажите инструкцию по оплате для пользователя, которые будут отображаться ему на странице с кнопкой "**Перейти к оплате**"

{% hint style="warning" %}
Для отображения реквизитов, полученных от мерчанта, непосредственно в заявке, в поле "**Инструкция по оплате для пользователя"** используйте шорткод **\[to\_account]**, когда мерчант подключен в направлении обмена.\
![](<../../../.gitbook/assets/image (1263).png>)

Подходящий текст для поля "**Инструкция по оплате для пользователя":**

{% code overflow="wrap" %}
```
<p>Переведите <strong>[copytext][sum1c][/copytext][currency_code_give] [psys_give]</strong></p>
<p>На адрес: [breakword]<strong>[copytext][to_account][/copytext], реквизиты принадлежат [dest_tag]</strong>[/breakword]</p>
<p>[qr_code size="200"][to_account][/qr_code]</p>
<p><strong>Внимание!</strong> Адрес имеет ограниченный срок жизни — не отправляйте средства после завершения срока заявки, это приведет к потере средств!</p>
<p>На оплату у вас осталось:</p>
[js_timer][bid_delete_time][/js_timer]
После оплаты система автоматически обработает платеж, как только он появится в сети.
```
{% endcode %}

Шорткод \[breakword] в данном случае корректно разобьёт длинный (от 30 символов) номер кошелька \[to\_account] — к примеру, по криптовалюте Monero (XMR)

Разумеется, вышеуказанную инструкцию вы можете скорректировать на своё усмотрение.
{% endhint %}

* **Примечание для платежа** — если данное поле отображается в настройках модуля мерчанта, <mark style="color:red;">**обязательно**</mark> заполните его, которое будет передаваться мерчанту. Корректное примечание платежа выглядит так: **`Заявка [exchange_id]`**
* **Погрешность суммы платежа** — при необходимости укажите погрешность (абсолютное значение в валюте платежа или % от суммы из заявки), в этом случае мерчант будет проверять сумму оплаты от пользователя с заданной погрешностью (в меньшую сторону)

{% hint style="info" %}
**Пример 1:**\
Задана погрешность 0,5. Пользователь должен оплатить 50 USDT, но по ошибке оплатил 49,9 USDT. При проверке мерчантом данный платеж будет засчитан, т.к. недоплата составила 0,1 USDT, что укладывается в рамки заданной погрешности 0,5.

\
**Пример 2:**\
Задана погрешность 1,5%. Пользователь должен оплатить 1000 DOGE, но по ошибке оплатил 990 DOGE. При проверке мерчантом данный платеж будет засчитан, т.к. недоплата составила 10 DOGE, что укладывается в рамки заданной погрешности 1,5% (1000\*1,5%=15 DOGE).
{% endhint %}

* **Суточный лимит для мерчанта** — при необходимости установите суточный лимит на прием средств для мерчанта. Мерчант не сможет принять оплату больше заданного лимита. Указывается в валюте, которую планируете принимать.

{% hint style="warning" %}
Если вы планируете использовать опции для установки лимитов и/или мин/макс сумм выплаты, а для приема различных валют используется один модуль мерчанта, то **необходимо** создать копии модуля под каждую валюту
{% endhint %}

* **Месячный лимит для мерчанта** — при необходимости установите месячный лимит на прием средств для мерчанта. Мерчант не сможет принять оплату больше заданного лимита
* **Мин. сумма платежа для одной заявки** — при необходимости установите минимальную сумму платежа для одной заявки. Мерчант не сможет принять оплату меньше заданного лимита
* **Макс. сумма платежа для одной заявки** — при необходимости установите максимальную сумму платежа для одной заявки. Мерчант не сможет принять оплату больше заданного лимита
* **Дневной лимит заявок (количество) для мерчанта** — количество выполненных заявок, которое можно создать в течение суток
* **Скрыть кнопку "Отменить заявку":**\
  • **Да** — убрать кнопку на странице заявки для клиента\
  • **Нет** — отобразить кнопку
* **Скрыть кнопку "Перейти к оплате":**\
  • **Да** — убрать кнопку **"Перейти к оплате"/"Я оплатил заявку"** на странице заявки для клиента\
  • **Нет** — отобразить кнопку
* **Сумма оплаты для пользователя** — сумма, которая будет отображаться пользователю при создании заявки:\
  • **сумма Отдаете (доп. ком.)**\
  • **сумма Отдаете (с доп. ком. и комиссией ПС)**\
  • **сумма для резерва**\
  • **сумма Отдаете**
* **Сумма ожидаемая к зачислению** — сумма, которая ожидается к зачислению на счет мерчанта:\
  • **сумма Отдаете (доп. ком.)**\
  • **сумма Отдаете (с доп. ком. и комиссией ПС)**\
  • **сумма для резерва**\
  • **сумма Отдаете**

{% hint style="warning" %}
Если мерчант берет комиссию при входящем платеже, то при выборе **типа суммы ожидаемой к зачислению** важно убедиться, что для вышеуказанного пункта выбран именно подходящий тип для корректной работы модуля и перевода заявку в статус "**Оплаченная**" при поступлении средств от клиента.

Для этого при подключенном в направлении мерчанта создайте заявку, не оплачивайте её, разверните её по кнопке "**Инфо**" в разделе "**Заявки**", выберите тот тип суммы, размер которой совпадает с одной из указанных сумм и будет зачислен на счет мерчанта после взимания комиссии.&#x20;

![](<../../../.gitbook/assets/image (2013).png>)

Часто это тип суммы "**Сумма для резерва**" в настройках модуля мерчанта — проверьте его в первую очередь. Выберите подходящий пункт, сохраните настройки и оплатите заявку. Если заявка после оплаты на полную сумму перейдет в статус "**Оплаченная**", то настройки установлены корректно.

![](<../../../.gitbook/assets/image (2014).png>)
{% endhint %}

* **Разрешенные IP адреса (с новой строки)** — задайте IP-адрес(а) платежной системы, которым будет разрешен доступ к статусному URL мерчанта. На данный URL платежная система присылает информацию о платеже. Если задать разрешенные IP-адреса, это повышает безопасность работы с мерчантом.

{% hint style="info" %}
IP-адрес(а) платежной системы, с которых она присылает информацию о платеже на статусный URL, можно узнать в технической поддержке платежной системы
{% endhint %}

* **Хэш Cron файла** — **придумайте** и укажите хэш, который дополнит URL задания Cron (набор произвольных 20-40 латинских букв и цифр)

{% hint style="danger" %}
Не забудьте создать задание Cron на сервере для проверки платежа — [**инструкция по настройке**](https://premium.gitbook.io/main/osnovnye-nastroiki/faq/kak-sozdat-zadanie-cron-na-servere)
{% endhint %}

* **Хэш для Status/Result URL** — **придумайте** и укажите хэш, который дополнит статусный URL мерчанта. На данный URL платежная система присылает информацию о платеже. Если задать хэш, статусный URL становится уникальным, что повышает безопасность работы с мерчантом. Рекомендуем использовать хэш длиной 20-50 символов, содержащий латинские буквы и цифры. Пример хэша — `ImYkwGsq2fjhuWypiasq2QJzVvCpis8umbxs8umbx`&#x20;

{% hint style="danger" %}
Если в настройках конкретного модуля мерчанта или автовыплаты отображается строка со Status URL/Callback URL, но нет упоминания о нём в инструкции по настройке самого модуля — можете игнорировать этот URL (работа с ним происходит на уровне кода без настройки администратором)\
\
При настройке мерчанта на стороне платежной системы в качестве статусного адреса (как правило это Status URL или Return URL) указывайте URL уже с заданным хэшем!
{% endhint %}

* **Режим отладки** — активируйте опцию только при первоначальной настройке или при проблемах при работе с мерчантом. При включенной опции будет записываться расширенный лог мерчанта в раздел "**Мерчанты**" ➔ "**Лог мерчантов**":\
  • **Нет**\
  • **Да**

## Работа со статусами заявок

В этом блоке настраивается работа мерчанта для определенных правил перехода заявки по статусам.

<figure><img src="../../../.gitbook/assets/image (806).png" alt="" width="563"><figcaption></figcaption></figure>

* **Номер счета с которого была сделана оплата не совпадает с указанным в заявке** — при несовпадении счета можно перевести заявку в другой статус или оставить имеющийся:\
  • **оставлять статус заявки "Новая заявка"**\
  • **изменять статус заявки на "На проверке"**\
  • **изменять статус заявки на "Оплаченная заявка"**
* **Сумма платежа меньше чем требуется** — если пользователь совершил транзакцию на меньшую сумму, чем указано в заявке, можно перевести заявку в другой статус или оставить имеющийся:\
  • **оставлять статус заявки "Новая заявка"**\
  • **изменять статус заявки на "На проверке"**\
  • **изменять статус заявки на "Оплаченная заявка"**
* **Сумма платежа больше чем требуется** — если пользователь совершил транзакцию на большую сумму, чем указано в заявке, можно перевести заявку в другой статус или оставить имеющийся:\
  • **оставлять статус заявки "Новая заявка"**\
  • **изменять статус заявки на "На проверке"**\
  • **изменять статус заявки на "Оплаченная заявка"**
* **Приоритет** — укажите приоритет от 1 до 10 (где: 0 или пустое поле — отсутствие приоритета или последний модуль по приоритету, с 1 по возрастанию — рост приоритета использования (0<1<2<3<...<9)), если в направлении обмена используются несколько модулей мерчантов

{% hint style="warning" %}
Наиболее подходящий мерчант для конкретной заявки выбирается автоматически с учетом приоритета. Мерчант не может быть заменен, если уже был использован в заявке.
{% endhint %}

## Настройки прокси (использовать только при необходимости)

В этом разделе указывается определенный IP-адрес, если нет доступа к мерчанту с обычного IP-адреса.

<figure><img src="../../../.gitbook/assets/изображение (3).png" alt=""><figcaption></figcaption></figure>

* **IP адрес** — адрес прокси-сервера
* **Порт** — порт прокси-сервера
* **Логин** — ваш логин для доступа к прокси-серверу
* **Пароль** — ваш пароль для доступа к прокси-серверу
* **Отключить прокси туннель** — отключение опции при заполненных выше полях\
  • **Нет**\
  • **Да**

## **Особые опции**

### Подключение нескольких мерчантов

{% hint style="success" %}
Начиная с версии 2.6, доступна опция замены мерчанта, если от него не удалось получить реквизиты для оплаты по каким-либо причинам (ошибки на стороне сервиса, ошибка авторизации в модуле, отсутствие доступных реквизитов у мерчанта и т.п.).
{% endhint %}

Доступные следующие варианты (раздел "**Настройки обменника**" -> "**Основные настройки**"):

{% hint style="info" %}
Если вы хотите продолжить использовать логику из версии 2.5, то выберите пункт "**Подключить мерчант**"
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (459).png" alt=""><figcaption></figcaption></figure>

**Действие, если мерчант не сработал**:

* **Подключить мерчант** — после неудачной попытки получения реквизитов заявка останется в статусе "**Новая заявка**", вместо шорткода **\[to\_account]** будет отображен текст из поля "**Текст ошибки, если счёт не указан**" (если реквизиты от мерчанты должны отображаться в заявке)

<figure><img src="../../../.gitbook/assets/image (1639).png" alt="" width="485"><figcaption></figcaption></figure>

или (начиная с версии 2.6), доступна опция замены текста на кнопке перехода на платежную страницу мерчанта, если по каким-то причинам мерчант (Bitconce Link, Firekassa Link и др.) не смог предоставить реквизиты для оплаты **в виде платежной страницы** (поле для текста на кнопке при получении ошибки находится в настройках используемого модуля мерчанта)

<div><figure><img src="../../../.gitbook/assets/image (1642).png" alt=""><figcaption></figcaption></figure> <figure><img src="../../../.gitbook/assets/image (1643).png" alt="" width="563"><figcaption></figcaption></figure></div>

* **Перевести заявку в ошибку мерчанта** — после неудачной попытки получения реквизитов заявка перейдет в статус "**Ошибка мерчанта**"
* **Попробовать подключить другой мерчант** — будут произведены попытки получения реквизитов от других мерчантов, подключенных в этом направлении обмена (согласно приоритету, указанного в настройках каждого модуля)

{% hint style="warning" %}
Если в настройках модуля мерчанта есть опция "**Статус ошибки мерчанта**":

<img src="../../../.gitbook/assets/image (2067).png" alt="" data-size="original">

Вы можете дополнительно настроить её (опция позволяет автоматически повторно запрашивать реквизиты у мерчанта, если они не были получены при создании заявки):

*   **Статус ошибки** — выполнится выбранное действие из опции "**Действие, если мерчант не сработал**" (раздел "**Настройки обменника**" -> "**Основные настройки**").\


    <figure><img src="../../../.gitbook/assets/image (2068).png" alt=""><figcaption></figcaption></figure>
* **Ожидание реквизитов от мерчанта** — заявка перейдет в статус "**Ожидание реквизитов от мерчанта**", если мерчант не сможет сразу предоставить реквизиты. Заявка перейдет обратно в статус "**Новая заявка**" после того, как реквизиты будут получены при повторном запросе.
{% endhint %}

{% hint style="warning" %}
Если в направлении обмена подключен только один мерчант и используется вариант "**Попробовать подключить другой мерчант**" с заполненным шаблоном для поля "**Текст ошибки, если счёт не указан**", то заявка останется в статусе "**Новая заявка**", вместо шорткода **\[to\_account]** будет отображен текст из поля "**Текст ошибки, если счёт не указан**" <mark style="background-color:yellow;">(если реквизиты от мерчанты должны отображаться в заявке)</mark> или будет отображаться кнопка с текстом ошибки для перехода на платежную страницу <mark style="background-color:yellow;">(если реквизиты для оплаты предоставляются мерчантом на собственной платежной странице)</mark>
{% endhint %}

* **Показать QR код на странице оплаты** — отображение QR-кода при переходе к оплате на странице заявки\
  • **Нет**\
  • **Да**
* **Персональная настройка статусов, которые можно принимать** — список статусов заявки, с которыми будет работать мерчант при получении уведомления об оплате от платежной системы.

{% hint style="warning" %}
Не используйте опцию "**Персональная настройка статусов, которые можно принимать**" без необходимости!

Если не выбран ни один из пунктов, то мерчант работает со статусами по умолчанию. Если выбрать статусы из списка, то мерчант будет работать **только** с выбранными статусами.
{% endhint %}

* **Назначить заявке статус ошибки, в случае ошибки API** — при ошибке ответа со стороны мерчанта, присваивать заявке статус ошибк&#x438;**:**\
  • **Нет**\
  • **Да**

{% hint style="info" %}
Начиная с версии 2.6, доступна опция замены текста на кнопке перехода на платежную страницу мерчанта, если по каким-то причинам мерчант (Bitconce Link, Firekassa Link и др.) не смог предоставить реквизиты для оплаты

![](<../../../.gitbook/assets/image (1642).png>)![](<../../../.gitbook/assets/image (1643).png>)
{% endhint %}

[^1]: укажите индивидуальное название для каждой копии в поле "Заголовок" для удобства последующей настройки
