# Уведомления по e-mail

Сайт может отправлять письма с помощью стандартной функции phpmailer, которая встроена в CMS WordPress.

{% hint style="warning" %}
Бесплатные аккаунты на mail.ru и yandex.ru могут работать некорректно или вовсе не отправлять письма получателям.

Для надежной отправки писем рекомендуем использовать платные почтовые аккаунты на сервисах, таких как [360.yandex.ru](https://360.yandex.ru/), [biz.mail.ru](https://biz.mail.ru/), [Postmark](https://postmarkapp.com/) или [Zeptomail](https://www.zoho.com/zeptomail/)
{% endhint %}

{% hint style="danger" %}
Обратите внимание, что шаблоны для **администраторов** и **пользователей** в выпадающем списке являются отдельными сущностями и настраиваются независимо друг от друга (пункты в выпадающем списке)

![](<../../.gitbook/assets/image (785).png>)![](<../../.gitbook/assets/image (786).png>)
{% endhint %}

## Основные настройки

В панели управления сайтом зайдите в раздел "**Сообщения"  → "E-mail шаблоны"** и настройте модуль:

<figure><img src="../../.gitbook/assets/image (1226).png" alt="" width="489"><figcaption></figcaption></figure>

* **E-mail отправителя** — почтовый ящик, от имени которого идет отправка письма. Это должен быть существующий ящик в рамках вашего домена. Например, support@ваш\_домен.ru. В противном случае письма могут не отправляться, либо попадать в спам. Создать такой почтовый ящик вы можете в панели управления вашего сервера.
* **Имя отправителя** — название сайта, от имени которого идет отправка письма. Если не заполнить данное поле, письма могут не отправляться или попадать в спам в ящике пользователей.
* **E-mail администратора** — почтовый ящик, от имени которого идет отправка письма от имени администратора

## Настройка SMTP

{% hint style="warning" %}
Крайне рекомендуем использовать SMTP для отправки писем, т.к. без его использования получателю будет известен IP-адрес вашего сервера, что может привести к DoS/DDoS-атакам с его стороны, если получателем окажется злоумышленник.
{% endhint %}

Настройте отправку писем через SMTP внешнего почтового сервиса. Одним из таких сервисов может выступать Яндекс.Почта или другой почтовый сервис, который предоставляет услугу SMTP.

Настройте SMTP для работы модуля:

<figure><img src="../../.gitbook/assets/image (1183).png" alt="" width="490"><figcaption></figcaption></figure>

{% hint style="warning" %}
Не указывайте настройки SMTP вашего сервера — используйте именно SMTP почтовых сервисов типа Яндекс, Mail.ru или Google
{% endhint %}

В разделе "**Сообщения" → "E-mail шаблоны"** вы найдете следующие настройки:

* **Включить SMTP:**\
  • "**Да**" — активация SMTP (вся почта с сайта будет отправляться с использованием SMTP).\
  • "**Нет**" — SMTP будет отключен
* **Тип соединения SMTP** — обычно используется тип соединения "**SSL**".
* **SMTP хост** — адрес SMTP сервера. У каждого почтового сервиса этот адрес уникальный. Для Яндекс.Почты адрес - `smtp.yandex.ru`, для Mail.ru - `smtp.mail.ru`.
* **SMTP порт** — порт SMTP сервера. У каждого почтового сервиса этот порт свой. Для Яндекс.Почты и Mail.ru используйте порт 465.
* **SMTP имя пользователя** — адрес зарегистрированного электронного ящика, например, `premiumexchanger@yandex.ru`
* **SMTP пароль** — специальный пароль от электронного ящика

{% hint style="warning" %}
Для использования опции "**SMTP пароль**", необходимо создать пароль для внешних приложений, если вы используете популярные почтовые сервисы:

* [инструкция для Mail.ru](https://help.mail.ru/mail/security/protection/external)
* [инструкция для Яндекс.Почты](https://yandex.ru/support/id/authorization/app-passwords.html)
* [инструкция для Zoho](https://www.zoho.com/mail/help/adminconsole/two-factor-authentication.html#password)
{% endhint %}

После ввода настроек нажмите кнопку "**Сохранить**". На странице вы найдете форму для отправки тестового письма, чтобы проверить корректность работы настроек отправки почты.

<figure><img src="../../.gitbook/assets/image (1098).png" alt="" width="499"><figcaption></figcaption></figure>

## Настройка шаблонов писем

{% embed url="https://youtu.be/g_YcR3FqPi0" %}

{% hint style="warning" %}
Еще раз обращаем ваше внимание, что шаблоны для **администраторов** и **пользователей** в выпадающем списке являются отдельными сущностями и настраиваются независимо друг от друга (пункты в выпадающем списке)\
![](<../../.gitbook/assets/image (785).png>)![](<../../.gitbook/assets/image (786).png>)
{% endhint %}

После того, как вы настроили отправку писем, настройте необходимые шаблоны для различных статусов заявок и других опций для отправления сообщений от имени сайта администраторам и пользователям:

<figure><img src="../../.gitbook/assets/image (1095).png" alt=""><figcaption></figcaption></figure>

* **Отправлять письмо:**\
  • "**Да**" — письмо будет отправляться\
  • "**Нет**" — письмо не будет отправляться
* **Тема письма** — укажите тему письма.
* **E-mail отправителя** — почтовый ящик, от имени которого идет отправка письма.
* **Имя отправителя** — название сайта, от имени которого идет отправка письма.
* **E-mail администратора** — почтовый адрес администратора, на который он хочет получить данное письмо. Через запятую можно указать несколько адресов.
* **Текст письма** — сам текст письма. Над полем для ввода текста вы найдете панель с \[шорткодами]. Используйте их в шаблоне письма, чтобы в отправляемых письмах отображались данные из заявок.

## Диагностика неисправностей

При подозрениях на некорректную работу опции, зайдите в раздел "**E-mail логи**" и посмотрите, что может являться причиной некорректной работы.

<figure><img src="../../.gitbook/assets/image (941).png" alt=""><figcaption></figcaption></figure>

Если у вас возникают проблемы с доставкой сообщений и нет явных причин для этого, рекомендуется принять следующие меры:

* Свяжитесь с вашим хостинг-провайдером и уточните, не блокирует ли он отправку писем. Возможно, существуют ограничения на сервере (к примеру, [релей](https://korporativnaya-pochta.com/articles/smart-relay-zaschita-ot-spama-dlya-korporativnoy-pochty)), которые мешают доставке электронной почты.
* Измените тему отправляемого письма для статуса "Новая заявка" на менее формальную. Возможно, при отправке письма активируется фильтр на SMTP-сервере, который блокирует доставку. Попробуйте использовать менее официальную тему, чтобы избежать фильтрации.

Если письма приходят только некоторым пользователям сайта или попадают в папку "Спам" - проверьте наличие [SPF и/или DKIM записей](https://neuropassenger.ru/dostavlyaemost-pisem/) для вашего домена и сконфигурируйте их при необходимости.

* [Проверка SPF записи](https://mxtoolbox.com/spf.aspx)
* [Проверка DKIM-записи](https://mxtoolbox.com/dkim.aspx)
