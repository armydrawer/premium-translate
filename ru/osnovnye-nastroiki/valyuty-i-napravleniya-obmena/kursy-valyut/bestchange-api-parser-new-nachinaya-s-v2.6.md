---
description: Модуль доступен начиная с версии 2.6!
---

# Bestchange API парсер (new, начиная с v2.6)

{% hint style="warning" %}
Переноса настроек из модуля Bestchange парсер невозможен по техническими причинам, поэтому для использования нового модуля понадобится настроить все курсы заново
{% endhint %}

{% hint style="danger" %}
Для автоматического обновления курсов валют **обязательно** создайте [задание Cron](https://premium.gitbook.io/rukovodstvo-polzovatelya/osnovnye-nastroiki/faq/kak-sozdat-zadanie-cron-na-servere) на сервере, используя ссылку из раздела "**BestChange API парсер**" -> "**Настройки**"

<img src="../../../.gitbook/assets/image (415).png" alt="" data-size="original">

Хэш для ссылки для задания cron задается в файле **`wp-content/plugins/premiumbox/userdata.php`**

<img src="../../../.gitbook/assets/image (416).png" alt="" data-size="original"> <img src="../../../.gitbook/assets/image (1520).png" alt="" data-size="original">
{% endhint %}

{% hint style="warning" %}
Обратите внимание, что использование Bestchange API парсера не гарантирует вам место в списке обменников на Bestchange, которое вы указываете в настройках парсера.

Модуль доступен для всех обменников, использующих скрипт Premium Exchanger — ваш конкурент может настроить парсер также как и вы, поэтому все обменники, которые используют парсер, будут находиться в борьбе за указанное место (чаще всего это 1-я позиция) в выбранном направлении обмена.

Единственный вариант гарантированного нахождения на первом месте — **постоянный демпинг**.

Также вы можете дополнительно настроить мин. и макс. курсы по этой инструкции, чтобы случайно не уйти в минус, если другой обменник также решил демпинговать (это потянет вас за ним, если выбрана привязка к первому месту и не настроена опция мин./макс. курсы)
{% endhint %}

{% hint style="danger" %}
Bestchange API парсер будет работать только в активном направлении обмена — при настройках парсера обязательно сделайте направление активным перед началом настройки

<img src="../../../.gitbook/assets/image (733).png" alt="" data-size="original">
{% endhint %}

## Общие настройки модуля

<figure><img src="../../../.gitbook/assets/image (2148).png" alt="" width="521"><figcaption></figcaption></figure>

**Домен** — укажите в поле один из доменов из списка под самим полем, если при пустом поле (когда парсер использует основной домен BC) парсер не работает (не отображаются валюты и города в списке ниже на этой же странице).

**Ключ API** — API ключ из [ЛК на сайте Bestchange](https://www.bestchange.ru/partner/profile.html)

<figure><img src="../../../.gitbook/assets/image (419).png" alt="" width="563"><figcaption></figcaption></figure>

**Таймаут (сек.)** — время ожидания ответа от Bestchange (рекомендуемое значение — 20 секунд. Если указан 0, то также применяется значение в 20 секунд)

**Устройство** — языковая версия сайта Bestchange (en или ru)

**Логирование** — запись логов запросов к сайту Bestchange и ответов от него для проверки корректности парсинга

<figure><img src="../../../.gitbook/assets/изображение (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

**Позиция:**\
&#xNAN;**• Rate** — базовое значение курса (формула расчета: rate = from\_amount / to\_amount)\
&#xNAN;**• Rankrate** — курс с примененными дополнительными комиссиями, рассчитанный для суммы обмена в $300. Этот курс выводится в Bestchange по умолчанию. Если нужно получить рейтинг обменников, отсортированный по курсу обмена как на Bestchange, то лучше использовать rankrate.

**Черный список ID обменников (через запятую)** — ID обменников, курсы которых будут игнорироваться при парсинге

<details>

<summary>Как узнать ID обменника?</summary>

Кликните на изображение ниже, чтобы увидеть, как найти ID обменника на сайте Bestchange.

<img src="../../../.gitbook/assets/Clip2net_230726151417.png" alt="" data-size="original">

</details>

**Белый список ID обменников (через запятую)** — ID обменников, курсы которых будут использоваться при парсинге (если указан хотя бы один ID — парсер будет использовать только курс этого источника, игнорируя остальные обменники)

**Удалять старые данные:**\
&#xNAN;**• Да** — данные, полученные от парсера будут удаляться перед каждым новым обновлением курса (если курс по каким-либо причинам не будет обновлен, он будет отображаться как 0 = 0 до следующего успешного обновления курса)\
&#xNAN;**• Нет** — данные, полученные от парсера не будут удаляться перед каждым новым обновлением курса (если курс по каким-либо причинам не будет обновлен, он будет отображать предыдущее полученное значение до следующего успешного обновления курса)

**Отключить защиту:**\
&#xNAN;**• Да** — защита от скачков курса отключена\
&#xNAN;**• Нет** — защита от скачка курса включена. Для защиты используются данные первых 5 мест в листинге Bestchange для расчета разницы между курсами — курс не может быть больше этой разницы

{% hint style="info" %}
**Описание механизма защиты**

Для предотвращения аномальных скачков мы используем данные, полученные от пяти обменников (они выделены подчеркиванием в таблице, открывающейся по кнопке "**Показать рейтинг**" в настройках Bestchange парсера в направлении обмена). Мы анализируем разницу между этими курсами и устанавливаем ограничение: курс не может превышать максимальную разницу, определенную на основе этих данных.

**Ключевые термины:**

<img src="../../../.gitbook/assets/image (323).png" alt="" data-size="original">

На скриншоте письмо, отправляемое администратору, если включена защита и активирован e-mail шаблон "**Bestchange ошибка безопасности**"

• **First rate** — курс первой позиции среди пяти источников

• **Your rate** — ваш текущий курс

• **Min security rate** — минимальный курс, который считается безопасным по нашим расчетам

<img src="../../../.gitbook/assets/image (324).png" alt="" data-size="original">

**Причины введения защиты**

В прошлом мы сталкивались с ситуациями, когда в Bestchange происходили резкие скачки курса из-за изменения формата представления курса (например, с 1 к XXX на XXX к 1). Для отслеживания таких аномалий была разработана данная защита.

**Условия работы защиты**

Данная защита будет эффективно работать, если вы добавляете небольшие значения к шагу, например, 0.0001. Если же вы добавляете более значительные значения, например, от 0.5% и выше, то курс уже будет считаться аномальным.
{% endhint %}

**Выберите валюты** — список доступных валют с Bestchange для парсинга (список будет отображаться только после указания валидного API ключа в настройках парсера)

<figure><img src="../../../.gitbook/assets/image (420).png" alt="" width="395"><figcaption></figcaption></figure>

**Выберите города** — список городов с Bestchange для парсинга (список будет отображаться только после указания валидного API ключа в настройках парсера)

<figure><img src="../../../.gitbook/assets/image (421).png" alt="" width="363"><figcaption></figcaption></figure>

## Настройки парсера в направлении обмена

В панели управления в разделе "**Направления обменов" → "Направления обменов"** перейдите к редактированию направления обмена.

На вкладке "**Автокорректировка курса**" и "**Bestchange парсер**" перед началом настройки BestChange API парсера отключите любые действующие автокорректировки курса, если такие настройки используются.

<div><figure><img src="../../../.gitbook/assets/image (423).png" alt="" width="359"><figcaption></figcaption></figure> <figure><img src="../../../.gitbook/assets/image (422).png" alt="" width="443"><figcaption></figcaption></figure></div>

На вкладке "**BestChange API парсер**" вы увидите блок настроек. Выполните необходимые настройки:

<figure><img src="../../../.gitbook/assets/image (424).png" alt="" width="563"><figcaption></figcaption></figure>

**Включить парсер:**\
&#xNAN;**• Да** — парсер включен в направлении обмена\
&#xNAN;**• Нет** — парсер не используется

{% hint style="warning" %}
Для активации парсера обязательно требуется выбрать 2 валюты в полях "**Валюты (Отдаете)**" и "**Валюты (Получаете)**"
{% endhint %}

**Черный список ID обменников (через запятую)** — ID обменников, курсы которых будут игнорироваться при парсинге

**Белый список ID обменников (через запятую)** — ID обменников, курсы которых будут использоваться при парсинге (если указан хотя бы один ID — парсер будет использовать только курс этого источника, игнорируя остальные обменники)

{% hint style="warning" %}
Если в общих настройках парсера аналогичные поля заполнены, они будет игнорироваться для настроек этого направления обмена — настройки в направлении обмена более высокоприоритетные.

Если в настройках направления обмена поля не заполнены, а общие заполнены, то для направления обмена будут применяться общие настройки.
{% endhint %}

**Город** — список городов, которые отмечены галочками в общих настройках парсера (город выбирается для направления обмена с наличными)

**Валюты (Отдаете)** — выбор валюты для стороны "**Отдаете**"

**Валюты (Получаете)** — выбор валюты для стороны "**Получаете**"

**Сторона курса**:\
&#xNAN;**• Авто** — автовыбор стороны курса для значений в полях "**Мин.курс**" и "**Макс. курс**"\
&#xNAN;**• 1 = XXX** — принудительная установка курса 1 к XXX\
&#xNAN;**• XXX = 1** — принудительная установка курса XXX к 1

**Позиция** — позиция из рейтинга Bestchange для выбранного направления обмена (если поле не заполнено, используется 1-я позиция)

**Шаг** — корректировка курса, полученного от парсера (например 0.001). Система по умолчанию всегда делает ваш курс выгоднее курса указанного значения из поля "**Позиция**". Также шаг можно задать в виде процента (например 3%).

Значение шага со знаком "**-**" будет делать ваш курс хуже курса заданной позиции (-0.001 или -3%), также можно использовать умножение и деление (\*2 или /2, \*3% или /3%)

**Мин. резерв для позиции** — значение минимального резерва для позиции (для валюты "**Получаете**"). Обменники, с резервом менее указанного значения, будут игнорироваться модулем

**Показать рейтинг** — страница с курсами валют из Bestchange и рекомендованным шагом

<figure><img src="../../../.gitbook/assets/image (1763).png" alt="" width="563"><figcaption></figcaption></figure>

**Мин. курс** — предельное нижнее значение курса, до которого будет работать привязка к позиции. Если конкурент по заданной позиции выйдет за рамки минимального курса, то модуль сбросит ваш курс на стандартный (если опция включена).

{% hint style="warning" %}
Если для одной или всех опций ("**Минимальный курс**", "**Максимальный курс**", "**Стандартный курс**" курсы будут указаны как вручную, так и выбраны курсы в опции "**Автокорректировка курса**",\
![](<../../../.gitbook/assets/image (1785).png>)\
то курс из поля "**Автокорректировка курса**" всегда будет более высокоприоритетным, именно он будет использоваться для работы парсера
{% endhint %}

**Автокорректировка мин. курса** — привязка минимального курса к выбранному источнику из раздела "**Парсеры 2.0**" -> "**Курсы**"\
&#xNAN;**• Добавляем к курсу** — регулировка минимального курса, получаемого из источника (к примеру, прибавление 3% или вычитание -3%)

**Макс. курс** — предельное верхнее значение курса, до которого будет работать привязка к позиции. Если конкурент по заданной позиции выйдет за рамки максимального курса, то модуль сбросит ваш курс на стандартный (если опция включена).

**Автокорректировка макс. курса** — привязка максимального курса к выбранному источнику из раздела "**Парсеры 2.0**" -> "**Курсы**"\
&#xNAN;**• Добавляем к курсу** — регулировка максимального курса, получаемого из источника (к примеру, прибавление 3% или вычитание -3%)

**Сбрасывать на стандартный курс:**\
&#xNAN;**• Да** — включение опции сброса на стандартный курс при выходе из диапазона мин/макс\
&#xNAN;**• Нет** — опция не используется

**Стандартный курс (Отдаете)** — ручное указание стандартного курса для стороны "**Отдаете**"

**Стандартный курс (Получаете)** — ручное указание стандартного курса для стороны "**Получаете**"

**Автокорректировка курса** — привязка стандартного курса к выбранному источнику из раздела "**Парсеры 2.0**" -> "**Курсы**"\
&#xNAN;**• Добавляем к курсу (Отдаете)** — регулировка максимального курса, получаемого из источника (к примеру, прибавление 3% или вычитание -3%) для стороны "**Отдаете**"\
&#xNAN;**• Добавляем к курсу (Получаете)** — регулировка максимального курса, получаемого из источника (к примеру, прибавление 3% или вычитание -3%) для стороны "**Получаете**"

**Преобразовать курс:**\
&#xNAN;**• Да** — принудительное преобразование курса обмена к формату 1 к ХХХ\
&#xNAN;**• Нет** — опция не используется
